# åŒ—é‚®å«æ˜Ÿè¿ç»´æ™ºèƒ½åŠ©æ‰‹ (BUPT Satellite O&M Agent)

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªä¸“ä¸ºå«æ˜Ÿè¿ç»´åœºæ™¯è®¾è®¡çš„æ™ºèƒ½åŠ©æ‰‹ï¼Œåˆ©ç”¨**æ£€ç´¢å¢å¼ºç”Ÿæˆ (RAG)**ã€**Agent å·¥å…·è°ƒç”¨**ä»¥åŠ**æ·±åº¦å­¦ä¹ å¼‚å¸¸æ£€æµ‹**æŠ€æœ¯ï¼Œä¸ºå«æ˜Ÿç®¡ç†äººå‘˜æä¾›ä¸€ç«™å¼çš„æ•…éšœè¯Šæ–­ã€é¥æµ‹æ•°æ®æŸ¥è¯¢ä¸åˆ†ææœåŠ¡ã€‚

## ğŸŒŸ æ ¸å¿ƒåŠŸèƒ½

1.  **ğŸ” æ™ºèƒ½æ•…éšœè¯Šæ–­ (RAG)**
    *   åŸºäºæœ¬åœ°çŸ¥è¯†åº“ï¼ˆç»´æŠ¤æ‰‹å†Œã€å†å²æ•…éšœæŠ¥å‘Šï¼‰å›ç­”ç”¨æˆ·é—®é¢˜ã€‚
    *   ä½¿ç”¨ FAISS å‘é‡æ£€ç´¢ + LLM æ€»ç»“ï¼Œæä¾›ç²¾ç¡®çš„æ•…éšœæ’æŸ¥æ­¥éª¤ã€‚
2.  **ğŸ“Š è‡ªç„¶è¯­è¨€æ•°æ®æŸ¥è¯¢ (Text-to-SQL/Pandas)**
    *   ç”¨æˆ·ç›´æ¥ä½¿ç”¨è‡ªç„¶è¯­è¨€ï¼ˆå¦‚â€œæŸ¥è¯¢2023å¹´ç¬¬7å‘¨å¸†æ¿æœªå±•å¼€çš„æ•°æ®â€ï¼‰ã€‚
    *   Agent è‡ªåŠ¨è§£ææ„å›¾ï¼Œä»é˜¿é‡Œäº‘ OSS ä¸‹è½½æ•°æ®å¹¶è¿›è¡Œç­›é€‰åˆ†æã€‚
3.  **ğŸ“‰ æ—¶åºå¼‚å¸¸æ£€æµ‹ (Time Series AD)**
    *   é›†æˆ LSTM æ·±åº¦å­¦ä¹ æ¨¡å‹ï¼Œå¯¹å«æ˜Ÿé¥æµ‹æ•°æ®è¿›è¡Œå®æ—¶/ç¦»çº¿å¼‚å¸¸æ£€æµ‹ã€‚
    *   è‡ªåŠ¨ç”Ÿæˆå¯è§†åŒ–å›¾è¡¨ï¼Œå¹¶æ ‡è®°å¼‚å¸¸æ—¶é—´ç‚¹ã€‚
4.  **ğŸ¥ å«æ˜Ÿå¥åº·ä½“æ£€**
    *   å¿«é€Ÿæ£€ç´¢å¹¶å±•ç¤ºå«æ˜Ÿå¹´åº¦å¥åº·åˆ†ææŠ¥å‘Šï¼ˆHTML/PDFï¼‰ã€‚

---

## ğŸ› ï¸ ç³»ç»Ÿæ¶æ„

é¡¹ç›®çš„æ ¸å¿ƒæ¶æ„åŸºäº **LangChain** æ¡†æ¶ï¼Œé‡‡ç”¨ **ReAct (Reasoning + Acting)** æ¨¡å¼ï¼š

```mermaid
graph TD
    User[ç”¨æˆ·] --> Frontend[Streamlit å‰ç«¯]
    Frontend --> Agent[LangChainæ ¸å¿ƒæ™ºèƒ½ä½“]
    Agent -->|å†³ç­–| Router{å·¥å…·è·¯ç”±}
    Router -->|æ£€ç´¢çŸ¥è¯†| KB[KB_Tool (FAISS)]
    Router -->|æŸ¥æ•°æ®| OSS[OSS_Tool (Aliyun)]
    Router -->|æµ‹å¼‚å¸¸| LSTM[LSTM_Tool (PyTorch)]
    Router -->|çœ‹æŠ¥å‘Š| Report[Report_Tool]
    KB --> LLM[å¤§æ¨¡å‹ (Qwen)]
    OSS --> Output[JSON/CSVç»“æœ]
    LSTM --> Plot[å¯è§†åŒ–å›¾è¡¨]
    LLM --> Answer[æœ€ç»ˆå›å¤]
```

---

## ğŸ“‚ ç›®å½•ç»“æ„è¯´æ˜

```text
agent/
â”œâ”€â”€ app.py                  # [å…¥å£] Streamlit å‰ç«¯åº”ç”¨
â”œâ”€â”€ agent.py                # [æ ¸å¿ƒ] å®šä¹‰ Agent é€»è¾‘ã€Prompt å’Œå·¥å…·é“¾
â”œâ”€â”€ agent_server.py         # [API] FastAPI æœåŠ¡ç«¯å…¥å£ (å¯é€‰)
â”œâ”€â”€ config.py               # [é…ç½®] API Keyã€è·¯å¾„ã€å…¨å±€å˜é‡
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ kb/                 # [çŸ¥è¯†åº“] å­˜æ”¾ .docx åŸå§‹æ–‡æ¡£å’Œè½¬æ¢è„šæœ¬
â”‚   â”œâ”€â”€ oss/                # [æ•°æ®] å­˜æ”¾ OSS ä¸‹è½½çš„ä¸´æ—¶æ•°æ®
â”‚   â””â”€â”€ E/                  # [ç¼“å­˜] æœ¬åœ°ç¼“å­˜çš„å«æ˜Ÿæ•°æ®åŒ…
â”œâ”€â”€ index/                  # [ç´¢å¼•] FAISS å‘é‡æ•°æ®åº“æ–‡ä»¶
â”œâ”€â”€ tools/                  # [å·¥å…·ç®±]
â”‚   â”œâ”€â”€ kb_tool.py          # çŸ¥è¯†åº“æ£€ç´¢å·¥å…·
â”‚   â”œâ”€â”€ oss_tool.py         # OSS æ•°æ®æ“ä½œå·¥å…·
â”‚   â”œâ”€â”€ lstm_tool.py        # å¼‚å¸¸æ£€æµ‹å·¥å…·å°è£…
â”‚   â”œâ”€â”€ lstm_impl.py        # LSTM æ¨¡å‹å…·ä½“å®ç°
â”‚   â””â”€â”€ report_tool.py      # æŠ¥å‘ŠæŸ¥è¯¢å·¥å…·
â”œâ”€â”€ oss/                    # [OSSè„šæœ¬] ä¸Šä¼ /ä¸‹è½½/æ•°æ®åˆ‡åˆ†ç‹¬ç«‹è„šæœ¬
â””â”€â”€ frontend/               # [é™æ€èµ„æº] HTML æŠ¥å‘Šå’Œå‰ç«¯å›¾ç‰‡
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹ (From Scratch)

### 1. ç¯å¢ƒå‡†å¤‡

è¯·ç¡®ä¿æ‚¨çš„ç³»ç»Ÿå·²å®‰è£…ï¼š
*   OS: Windows / Linux / macOS
*   Python: 3.8 ~ 3.11
*   æ¨èä½¿ç”¨ Conda ç®¡ç†ç¯å¢ƒ

#### åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
```bash
conda create -n satellite_agent python=3.10
conda activate satellite_agent
```

### 2. å®‰è£…ä¾èµ–

è¯·å®‰è£…é¡¹ç›®æ‰€éœ€çš„æ ¸å¿ƒä¾èµ–åº“ï¼š

```bash
pip install streamlit langchain langchain-community langchain-openai pandas oss2 duckdb torch faiss-cpu python-docx openpyxl plotly matplotlib dashscope
```

### 3. é…ç½®é¡¹ç›® (`config.py`)

æœ¬é¡¹ç›®ä¾èµ–é˜¿é‡Œäº‘å¤§æ¨¡å‹æœåŠ¡ (DashScope) å’Œ OSS å¯¹è±¡å­˜å‚¨ã€‚ä½ éœ€è¦ä¿®æ”¹ `config.py` æˆ–è®¾ç½®ç¯å¢ƒå˜é‡ã€‚

**æ–¹å¼ A: ä¿®æ”¹ `config.py` (ä»…é™æœ¬åœ°å¼€å‘)**
æ‰“å¼€ `config.py`ï¼Œé…ç½®ä»¥ä¸‹å…³é”®é¡¹ï¼š

```python
# --- æ¨¡å‹é…ç½® ---
DASHSCOPE_API_KEY = "sk-xxxxxxxxxxxxxxxx"  # ä½ çš„é˜¿é‡Œäº‘ç™¾ç‚¼ API Key

# --- OSS é…ç½® (config.py ä¸­å¯èƒ½ç›´æ¥è¯»å–ç¯å¢ƒå˜é‡) ---
# å¦‚æœ config.py ä¸­æ²¡æœ‰å®šä¹‰ï¼Œè¯·ç¡®ä¿ç¯å¢ƒå˜é‡å·²è®¾ç½®
```

**æ–¹å¼ B: ç¯å¢ƒå˜é‡ (æ¨èï¼Œå®‰å…¨)**
åœ¨è¿è¡Œå‰è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œé¿å… Key æ³„éœ²ï¼š

**Windows (PowerShell):**
```powershell
$env:DASHSCOPE_API_KEY="ä½ çš„API_Key"
$env:OSS_ACCESS_KEY_ID="ä½ çš„OSS_AccessKey_ID"
$env:OSS_ACCESS_KEY_SECRET="ä½ çš„OSS_AccessKey_Secret"
```

**Linux / macOS:**
```bash
export DASHSCOPE_API_KEY="ä½ çš„API_Key"
export OSS_ACCESS_KEY_ID="ä½ çš„OSS_AccessKey_ID"
export OSS_ACCESS_KEY_SECRET="ä½ çš„OSS_AccessKey_Secret"
```

### 4. åˆå§‹åŒ–çŸ¥è¯†åº“ (RAG)

å¦‚æœä½ æ˜¯åˆæ¬¡è¿è¡Œï¼Œæˆ–è€…åœ¨ `data/kb/` ä¸­æ·»åŠ äº†æ–°çš„æ•…éšœæ‰‹å†Œï¼ˆ.docx æˆ– .mdï¼‰ï¼Œå¿…é¡»æ‰§è¡Œä»¥ä¸‹æ­¥éª¤æ¥æ„å»ºç´¢å¼•ï¼Œå¦åˆ™æ™ºèƒ½ä½“æ— æ³•å›ç­”çŸ¥è¯†åº“é—®é¢˜ã€‚

**æ­¥éª¤ 1: æ”¾ç½®æ–‡æ¡£**
å°† `.docx` æˆ– `.md` æ–‡ä»¶æ”¾å…¥ `data/kb/` ç›®å½•ã€‚

**æ­¥éª¤ 2: æ ¼å¼è½¬æ¢ (Docx -> Markdown)**
```bash
python data/kb/convert_docs.py
```
*æ­¤è„šæœ¬ä¼šè¯»å– docs å¹¶ç”Ÿæˆ markdown æ–‡ä»¶åˆ° `data/kb/kb_md/` ç›®å½•ã€‚*

**æ­¥éª¤ 3: æ„å»ºå‘é‡ç´¢å¼•**
```bash
python index/build_index.py
```
*çœ‹è§ "Index built successfully" å³è¡¨ç¤ºæˆåŠŸã€‚*

### 5. å¯åŠ¨åº”ç”¨

ä¸€åˆ‡å‡†å¤‡å°±ç»ªï¼Œè¿è¡Œ Streamlit å‰ç«¯ï¼š

```bash
python -m streamlit run app.py
```

æµè§ˆå™¨å°†è‡ªåŠ¨æ‰“å¼€ `http://localhost:8501`ã€‚

---

## ğŸ§ª ä½¿ç”¨æŒ‡å—ä¸æµ‹è¯•æ¡ˆä¾‹

å¯åŠ¨ç•Œé¢åï¼Œä½ ä¼šåœ¨å·¦ä¾§çœ‹åˆ°æ§åˆ¶é¢æ¿ï¼Œå³ä¾§æ˜¯å¯¹è¯çª—å£ã€‚

### åœºæ™¯ä¸€ï¼šæ•…éšœæ’æŸ¥ (çŸ¥è¯†åº“é—®ç­”)
é‡åˆ°å«æ˜Ÿæ•…éšœæ—¶ï¼Œç›´æ¥è¯¢é—®ã€‚
> **ç”¨æˆ·**: "GNSS æ•…éšœè¯Šæ–­çš„ä¸€èˆ¬æ­¥éª¤æ˜¯ä»€ä¹ˆï¼Ÿ"
> **Agent**: (è‡ªåŠ¨æ ¹æ® `index/` ä¸­çš„ç´¢å¼•æ£€ç´¢æ–‡æ¡£) "æ ¹æ®æ£€ç´¢åˆ°çš„ç»´æŠ¤æ‰‹å†Œï¼ŒGNSS æ•…éšœè¯Šæ–­æ­¥éª¤å¦‚ä¸‹ï¼š..."

### åœºæ™¯äºŒï¼šæ•°æ®åæŸ¥ (OSS/CSV)
éœ€è¦æŸ¥çœ‹ç‰¹å®šæ¡ä»¶çš„é¥æµ‹æ•°æ®ã€‚
> **ç”¨æˆ·**: "æŸ¥è¯¢Eå«æ˜Ÿ0x0821åŒ…ï¼Œ2023å¹´ç¬¬7å‘¨ï¼Œâ€˜å¸†æ¿1çŠ¶æ€â€™ä¸ºâ€˜æœªå±•å¼€â€™çš„æ•°æ®ã€‚"
> **Agent**: (è‡ªåŠ¨ä¸‹è½½ `2023_07.csv` åˆ°æœ¬åœ° `data/E/0x0821/`ï¼Œç­›é€‰æ•°æ®) "ä¸‹è½½æˆåŠŸï¼ŒæŸ¥è¯¢åˆ° 5 æ¡è®°å½•ï¼Œå·²ä¸ºæ‚¨ç”Ÿæˆæ–‡ä»¶ã€‚"

### åœºæ™¯ä¸‰ï¼šå¼‚å¸¸æ£€æµ‹
å¯¹å½“å‰å…³æ³¨çš„æ•°æ®æ®µè¿›è¡Œæ·±åº¦åˆ†æã€‚
> **ç”¨æˆ·**: "è¿è¡Œ LSTM æ¨¡å‹æ£€æµ‹å½“å‰æ•°æ®çš„å¼‚å¸¸ã€‚"
> **Agent**: (åŠ è½½ `lstm_impl.py` ä¸­çš„æ¨¡å‹) "æ£€æµ‹å®Œæˆã€‚å‘ç°å¼‚å¸¸ç‚¹ï¼Œå·²ç”Ÿæˆå¯è§†åŒ–å›¾è¡¨ã€‚"

### åœºæ™¯å››ï¼šæŸ¥çœ‹æŠ¥å‘Š
> **ç”¨æˆ·**: "å±•ç¤ºå¹´åº¦æŠ¥å‘Šã€‚"
> **Agent**: (åŠ è½½ `frontend/satellite.html`) "å¥½çš„ï¼Œå¹´åº¦æŠ¥å‘Šå¦‚ä¸‹..."

---

## â“ å¸¸è§é—®é¢˜ (FAQ)

**Q1: å¯åŠ¨æ—¶æŠ¥é”™ `ModuleNotFoundError`?**
A: è¯·æ£€æŸ¥æ˜¯å¦å¿˜è®°å®‰è£…ä¾èµ–ï¼Œå¸¸è§çš„æœ‰ `faiss-cpu`, `python-docx`ã€‚

**Q2: çŸ¥è¯†åº“å›ç­”â€œæœªæ‰¾åˆ°ç›¸å…³å†…å®¹â€ï¼Ÿ**
A: è¯·ç¡®è®¤ï¼š
1. `data/kb/` ä¸‹æ˜¯å¦æœ‰ç›¸å…³å†…å®¹çš„æ–‡æ¡£ã€‚
2. æ˜¯å¦æˆåŠŸè¿è¡Œäº† `index/build_index.py`ã€‚
3. `config.py` ä¸­çš„ `DASHSCOPE_API_KEY` æ˜¯å¦æœ‰æ•ˆã€‚

**Q3: OSS ä¸‹è½½å¤±è´¥ï¼Ÿ**
A: æ£€æŸ¥ `config.py` æˆ–ç¯å¢ƒå˜é‡ä¸­çš„ OSS Keyã€Endpoint å’Œ Bucket åç§°æ˜¯å¦æ­£ç¡®ã€‚æ³¨æ„ OSS é€šå¸¸åŒºåˆ†å†…ç½‘å’Œå¤–ç½‘ Endpointã€‚

---

## ğŸ¤ è´¡çŒ®æŒ‡å—

1.  Fork æœ¬ä»“åº“ã€‚
2.  æ–°å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)ã€‚
3.  æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)ã€‚
4.  æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)ã€‚
5.  æäº¤ Pull Requestã€‚

---
**Â© 2025 BUPT Satellite Team**
